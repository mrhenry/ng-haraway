var module_1 = require('./module');
module_1.mod.directive('harawayChooser', [function () {
        return {
            restrict: 'A',
            scope: {
                modelPath: '@ngModel',
                multiple: '@',
                accept: '@',
                profile: '@',
                autoUpload: '@',
            },
            controller: ['$scope', '$element', function ($scope, $element) {
                    $scope.multiple = $element.attr('multiple');
                    $scope.autoUpload = $element.attr('auto-upload');
                    var Haraway = window['Haraway'];
                    var modelPath = $scope.modelPath;
                    var accept = ($scope.accept || '').split(' ');
                    var multiple = ($scope.multiple === 'true' || $scope.multiple === 'multiple' || $scope.multiple === '');
                    var autoUpload = ($scope.autoUpload === 'true' || $scope.autoUpload === 'auto-upload' || $scope.autoUpload === '');
                    var profile = $scope.profile;
                    if (multiple) {
                        $scope.$parent.$eval(modelPath + ' = ' + modelPath + ' || [];');
                        $scope.files = $scope.$parent.$eval(modelPath);
                    }
                    else {
                        $scope.files = [];
                        var file = $scope.$parent.$eval(modelPath);
                        if (file)
                            $scope.files.push(file);
                    }
                    $scope.$watch('files');
                    $element.on('click', handleClick);
                    $scope.$on('$destroy', function () {
                        $element.off('click', handleClick);
                    });
                    function handleClick(e) {
                        var Haraway = window['Haraway'];
                        e.preventDefault();
                        if (multiple) {
                            Haraway.choose(accept, multiple, profile, handleFiles);
                        }
                        else {
                            Haraway.choose(accept, multiple, profile, handleFile);
                        }
                    }
                    function handleFile(file) {
                        var wrapper = wrapFile($scope.$parent, file);
                        if (autoUpload)
                            wrapper.$upload();
                        $scope.files = [wrapper];
                        $scope.$parent.$evalAsync($scope.modelPath + ' = $harawayFile', { $harawayFile: wrapper });
                        return false;
                    }
                    function handleFiles(file) {
                        var wrapper = wrapFile($scope.$parent, file);
                        if (autoUpload)
                            wrapper.$upload();
                        $scope.$evalAsync(function () {
                            $scope.files.push(wrapper);
                        });
                        return false;
                    }
                }]
        };
    }]);
function wrapFile($scope, file) {
    var wrapper = {
        id: null,
        _destroy: false,
        attributes: {
            file_name: file.name,
        },
        $info: file,
        $upload: file.upload.bind(file),
    };
    file.state = 'pending';
    file.on('queued', function () {
        file.state = 'queued';
        $scope.$digest();
    });
    file.on('busy', function () {
        $scope.$digest();
    });
    file.on('idle', function () {
        $scope.$digest();
    });
    file.on('start', function () {
        file.state = 'uploading';
        $scope.$digest();
    });
    file.on('progress', function () {
        $scope.$digest();
    });
    file.on('err', function (err) {
        file.state = 'failed';
        file.error = err;
        $scope.$digest();
    });
    file.on('done:uploading', function () {
        file.state = 'processing';
        $scope.$digest();
    });
    file.on('done:processing', function () {
        $scope.$digest();
    });
    file.on('done', function () {
        file.state = 'uploaded';
        wrapper.id = file.metadata.id;
        $scope.$digest();
    });
    return wrapper;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hvb3Nlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9jaG9vc2VyLnRzIl0sIm5hbWVzIjpbImhhbmRsZUNsaWNrIiwiaGFuZGxlRmlsZSIsImhhbmRsZUZpbGVzIiwid3JhcEZpbGUiXSwibWFwcGluZ3MiOiJBQUFBLHVCQUFrQixVQUFVLENBQUMsQ0FBQTtBQUU3QixZQUFHLENBQUMsU0FBUyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDaEMsTUFBTSxDQUFDO1lBQ04sUUFBUSxFQUFFLEdBQUc7WUFFYixLQUFLLEVBQUU7Z0JBQ04sU0FBUyxFQUFFLFVBQVU7Z0JBQ3JCLFFBQVEsRUFBRSxHQUFHO2dCQUNiLE1BQU0sRUFBRSxHQUFHO2dCQUNYLE9BQU8sRUFBRSxHQUFHO2dCQUNaLFVBQVUsRUFBRSxHQUFHO2FBQ2Y7WUFFRCxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLFVBQVUsTUFBTSxFQUFFLFFBQWdCO29CQUNwRSxNQUFNLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7b0JBQzVDLE1BQU0sQ0FBQyxVQUFVLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztvQkFDakQsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO29CQUNoQyxJQUFJLFNBQVMsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDO29CQUNqQyxJQUFJLE1BQU0sR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUM5QyxJQUFJLFFBQVEsR0FBRyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEtBQUssTUFBTSxJQUFJLE1BQU0sQ0FBQyxRQUFRLEtBQUssVUFBVSxJQUFJLE1BQU0sQ0FBQyxRQUFRLEtBQUssRUFBRSxDQUFDLENBQUM7b0JBQ3hHLElBQUksVUFBVSxHQUFHLENBQUMsTUFB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QTtJQUVIQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxVQUFVQSxFQUFFQTtRQUNuQixNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDbEIsQ0FBQyxDQUFDQSxDQUFDQTtJQUVIQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxLQUFLQSxFQUFFQSxVQUFTQSxHQUFHQTtRQUMxQixJQUFJLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQztRQUN0QixJQUFJLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztRQUNqQixNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDbEIsQ0FBQyxDQUFDQSxDQUFDQTtJQUVIQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxnQkFBZ0JBLEVBQUVBO1FBQ3pCLElBQUksQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDO1FBQzFCLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNsQixDQUFDLENBQUNBLENBQUNBO0lBRUhBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLGlCQUFpQkEsRUFBRUE7UUFDMUIsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2xCLENBQUMsQ0FBQ0EsQ0FBQ0E7SUFFSEEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsRUFBRUE7UUFDZixJQUFJLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQztRQUN4QixPQUFPLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1FBQzlCLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNsQixDQUFDLENBQUNBLENBQUNBO0lBRUhBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBO0FBQ2hCQSxDQUFDQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7bW9kfSBmcm9tICcuL21vZHVsZSc7XG5cbm1vZC5kaXJlY3RpdmUoJ2hhcmF3YXlDaG9vc2VyJywgW2Z1bmN0aW9uICgpIHtcblx0cmV0dXJuIHtcblx0XHRyZXN0cmljdDogJ0EnLFxuXG5cdFx0c2NvcGU6IHtcblx0XHRcdG1vZGVsUGF0aDogJ0BuZ01vZGVsJyxcblx0XHRcdG11bHRpcGxlOiAnQCcsXG5cdFx0XHRhY2NlcHQ6ICdAJyxcblx0XHRcdHByb2ZpbGU6ICdAJyxcblx0XHRcdGF1dG9VcGxvYWQ6ICdAJyxcblx0XHR9LFxuXG5cdFx0Y29udHJvbGxlcjogWyckc2NvcGUnLCAnJGVsZW1lbnQnLCBmdW5jdGlvbiAoJHNjb3BlLCAkZWxlbWVudDogSlF1ZXJ5KSB7XG5cdFx0XHQkc2NvcGUubXVsdGlwbGUgPSAkZWxlbWVudC5hdHRyKCdtdWx0aXBsZScpO1xuXHRcdFx0JHNjb3BlLmF1dG9VcGxvYWQgPSAkZWxlbWVudC5hdHRyKCdhdXRvLXVwbG9hZCcpO1xuXHRcdFx0bGV0IEhhcmF3YXkgPSB3aW5kb3dbJ0hhcmF3YXknXTtcblx0XHRcdGxldCBtb2RlbFBhdGggPSAkc2NvcGUubW9kZWxQYXRoO1xuXHRcdFx0bGV0IGFjY2VwdCA9ICgkc2NvcGUuYWNjZXB0IHx8ICcnKS5zcGxpdCgnICcpO1xuXHRcdFx0bGV0IG11bHRpcGxlID0gKCRzY29wZS5tdWx0aXBsZSA9PT0gJ3RydWUnIHx8ICRzY29wZS5tdWx0aXBsZSA9PT0gJ211bHRpcGxlJyB8fCAkc2NvcGUubXVsdGlwbGUgPT09ICcnKTtcblx0XHRcdGxldCBhdXRvVXBsb2FkID0gKCRzY29wZS5hdXRvVXBsb2FkID09PSAndHJ1ZScgfHwgJHNjb3BlLmF1dG9VcGxvYWQgPT09ICdhdXRvLXVwbG9hZCcgfHwgJHNjb3BlLmF1dG9VcGxvYWQgPT09ICcnKTtcblx0XHRcdGxldCBwcm9maWxlID0gJHNjb3BlLnByb2ZpbGU7XG5cblx0XHRcdGlmIChtdWx0aXBsZSkge1xuXHRcdFx0XHQkc2NvcGUuJHBhcmVudC4kZXZhbChtb2RlbFBhdGgrJyA9ICcrbW9kZWxQYXRoKyAnIHx8IFtdOycpO1xuXHRcdFx0XHQkc2NvcGUuZmlsZXMgPSAkc2NvcGUuJHBhcmVudC4kZXZhbChtb2RlbFBhdGgpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0JHNjb3BlLmZpbGVzID0gW107XG5cdFx0XHRcdGxldCBmaWxlID0gJHNjb3BlLiRwYXJlbnQuJGV2YWwobW9kZWxQYXRoKTtcblx0XHRcdFx0aWYgKGZpbGUpICRzY29wZS5maWxlcy5wdXNoKGZpbGUpO1xuXHRcdFx0fVxuXG5cdFx0XHQkc2NvcGUuJHdhdGNoKCdmaWxlcycpXG5cblx0XHRcdCRlbGVtZW50Lm9uKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcblx0XHRcdCRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHQkZWxlbWVudC5vZmYoJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuXHRcdFx0fSk7XG5cblx0XHRcdGZ1bmN0aW9uIGhhbmRsZUNsaWNrKGU6IEV2ZW50KSB7XG5cdFx0XHRcdGxldCBIYXJhd2F5ID0gd2luZG93WydIYXJhd2F5J107XG5cblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdGlmIChtdWx0aXBsZSkge1xuXHRcdFx0XHRcdEhhcmF3YXkuY2hvb3NlKGFjY2VwdCwgbXVsdGlwbGUsIHByb2ZpbGUsIGhhbmRsZUZpbGVzKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRIYXJhd2F5LmNob29zZShhY2NlcHQsIG11bHRpcGxlLCBwcm9maWxlLCBoYW5kbGVGaWxlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBoYW5kbGVGaWxlKGZpbGU6IEhhcmF3YXlGaWxlKSB7XG5cdFx0XHRcdGxldCB3cmFwcGVyID0gd3JhcEZpbGUoJHNjb3BlLiRwYXJlbnQsIGZpbGUpO1xuXHRcdFx0XHRpZiAoYXV0b1VwbG9hZCkgd3JhcHBlci4kdXBsb2FkKCk7XG5cdFx0XHRcdCRzY29wZS5maWxlcyA9IFt3cmFwcGVyXTtcblx0XHRcdFx0JHNjb3BlLiRwYXJlbnQuJGV2YWxBc3luYygkc2NvcGUubW9kZWxQYXRoKycgPSAkaGFyYXdheUZpbGUnLCB7JGhhcmF3YXlGaWxlOiB3cmFwcGVyfSk7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gaGFuZGxlRmlsZXMoZmlsZTogSGFyYXdheUZpbGUpIHtcblx0XHRcdFx0bGV0IHdyYXBwZXIgPSB3cmFwRmlsZSgkc2NvcGUuJHBhcmVudCwgZmlsZSk7XG5cdFx0XHRcdGlmIChhdXRvVXBsb2FkKSB3cmFwcGVyLiR1cGxvYWQoKTtcblx0XHRcdFx0JHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24oKXtcblx0XHRcdFx0XHQkc2NvcGUuZmlsZXMucHVzaCh3cmFwcGVyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9XVxuXHR9O1xufV0pO1xuXG5pbnRlcmZhY2UgRmlsZSB7XG5cdGlkOiAgICAgICAgIHN0cmluZztcblx0X2Rlc3Ryb3k6ICAgYm9vbGVhbjtcblx0YXR0cmlidXRlczogT2JqZWN0O1xuXHQkaW5mbzogSGFyYXdheUZpbGU7XG5cdCR1cGxvYWQoKTtcbn1cblxuaW50ZXJmYWNlIEhhcmF3YXlGaWxlIHtcblx0bmFtZTogc3RyaW5nO1xuXHRtZXRhZGF0YTogSGFyYXdheU1ldGFkYXRhRmlsZTtcblx0c3RhdGU6IHN0cmluZztcblx0ZXJyb3I6IGFueTtcblx0b24oZXZlbnQ6c3RyaW5nLCBmdW5jOkZ1bmN0aW9uKSA6IHZvaWQ7XG5cdHVwbG9hZCgpO1xufVxuXG5pbnRlcmZhY2UgSGFyYXdheU1ldGFkYXRhRmlsZSB7XG5cdGlkOiBzdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHdyYXBGaWxlKCRzY29wZSwgZmlsZTogSGFyYXdheUZpbGUpOiBGaWxlIHtcblx0bGV0IHdyYXBwZXIgOiBGaWxlID0ge1xuXHRcdGlkOiBudWxsLFxuXHRcdF9kZXN0cm95OiBmYWxzZSxcblx0XHRhdHRyaWJ1dGVzOiB7XG5cdFx0XHRmaWxlX25hbWU6IGZpbGUubmFtZSxcblx0XHR9LFxuXHRcdCRpbmZvOiBmaWxlLFxuXHRcdCR1cGxvYWQ6IGZpbGUudXBsb2FkLmJpbmQoZmlsZSksXG5cdH07XG5cblx0ZmlsZS5zdGF0ZSA9ICdwZW5kaW5nJztcblxuXHRmaWxlLm9uKCdxdWV1ZWQnLCBmdW5jdGlvbigpIHtcblx0XHRmaWxlLnN0YXRlID0gJ3F1ZXVlZCc7XG5cdFx0JHNjb3BlLiRkaWdlc3QoKTtcblx0fSk7XG5cblx0ZmlsZS5vbignYnVzeScsIGZ1bmN0aW9uKCkge1xuXHRcdCRzY29wZS4kZGlnZXN0KCk7XG5cdH0pO1xuXG5cdGZpbGUub24oJ2lkbGUnLCBmdW5jdGlvbigpIHtcblx0XHQkc2NvcGUuJGRpZ2VzdCgpO1xuXHR9KTtcblxuXHRmaWxlLm9uKCdzdGFydCcsIGZ1bmN0aW9uKCkge1xuXHRcdGZpbGUuc3RhdGUgPSAndXBsb2FkaW5nJztcblx0XHQkc2NvcGUuJGRpZ2VzdCgpO1xuXHR9KTtcblxuXHRmaWxlLm9uKCdwcm9ncmVzcycsIGZ1bmN0aW9uKCkge1xuXHRcdCRzY29wZS4kZGlnZXN0KCk7XG5cdH0pO1xuXG5cdGZpbGUub24oJ2VycicsIGZ1bmN0aW9uKGVycikge1xuXHRcdGZpbGUuc3RhdGUgPSAnZmFpbGVkJztcblx0XHRmaWxlLmVycm9yID0gZXJyO1xuXHRcdCRzY29wZS4kZGlnZXN0KCk7XG5cdH0pO1xuXG5cdGZpbGUub24oJ2RvbmU6dXBsb2FkaW5nJywgZnVuY3Rpb24oKSB7XG5cdFx0ZmlsZS5zdGF0ZSA9ICdwcm9jZXNzaW5nJztcblx0XHQkc2NvcGUuJGRpZ2VzdCgpO1xuXHR9KTtcblxuXHRmaWxlLm9uKCdkb25lOnByb2Nlc3NpbmcnLCBmdW5jdGlvbigpIHtcblx0XHQkc2NvcGUuJGRpZ2VzdCgpO1xuXHR9KTtcblxuXHRmaWxlLm9uKCdkb25lJywgZnVuY3Rpb24oKSB7XG5cdFx0ZmlsZS5zdGF0ZSA9ICd1cGxvYWRlZCc7XG5cdFx0d3JhcHBlci5pZCA9IGZpbGUubWV0YWRhdGEuaWQ7XG5cdFx0JHNjb3BlLiRkaWdlc3QoKTtcblx0fSk7XG5cblx0cmV0dXJuIHdyYXBwZXI7XG59XG4iXX0=